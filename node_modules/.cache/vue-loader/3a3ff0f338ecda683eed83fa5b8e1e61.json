{"remainingRequest":"/Users/mttest/Profile/mac-drive-web/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/mttest/Profile/mac-drive-web/src/views/components/FileGrid.vue?vue&type=style&index=0&id=05590e31&lang=stylus&scoped=true&","dependencies":[{"path":"/Users/mttest/Profile/mac-drive-web/src/views/components/FileGrid.vue","mtime":1701827905864},{"path":"/Users/mttest/Profile/mac-drive-web/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mttest/Profile/mac-drive-web/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/mttest/Profile/mac-drive-web/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/mttest/Profile/mac-drive-web/node_modules/stylus-loader/index.js","mtime":1519606876000},{"path":"/Users/mttest/Profile/mac-drive-web/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/mttest/Profile/mac-drive-web/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgpAaW1wb3J0ICd+QC9hc3NldHMvc3R5bGUvbWl4aW5zLnN0eWwnOwoKLmZpbGUtbGlzdCB7CiAgaGVpZ2h0OiBjYWxjKDEwMHZoIC0gMjM3cHgpOwogIGRpc3BsYXk6IGZsZXg7CiAgZmxleC13cmFwOiB3cmFwOwogIGFsaWduLWl0ZW1zOiBmbGV4LXN0YXJ0OwogIGFsaWduLWNvbnRlbnQ6IGZsZXgtc3RhcnQ7CiAgbGlzdC1zdHlsZTogbm9uZTsKICBvdmVyZmxvdy15OiBhdXRvOwogIHNldFNjcm9sbGJhcig4cHgsICNFQkVFRjUsICM5MDkzOTkpOwoKICAuZmlsZS1pdGVtIHsKICAgIG1hcmdpbjogMTZweCAxNnB4IDAgMDsKICAgIGJvcmRlci1yYWRpdXM6IDRweDsKICAgIHdpZHRoOiAxMjBweDsKICAgIHBhZGRpbmc6IDhweDsKICAgIGN1cnNvcjogcG9pbnRlcjsKICAgIHRleHQtYWxpZ246IGNlbnRlcjsKCiAgICAmOmhvdmVyIHsKICAgICAgYmFja2dyb3VuZDogI0Y1RjdGQTsKICAgIH0KCiAgICAuZmlsZS1pbWcgewogICAgICB3aWR0aDogMTAwcHg7CiAgICAgIGhlaWdodDogMTAwcHg7CiAgICB9CgogICAgLmZpbGUtbmFtZSB7CiAgICAgIGxpbmUtaGVpZ2h0OiAyNHB4OwogICAgICBmb250LXNpemU6IDEycHg7CiAgICAgIHdvcmQtYnJlYWs6IGJyZWFrLWFsbDsKICAgICAgc2V0RWxsaXBzaXMoMik7CiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["FileGrid.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiQA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"FileGrid.vue","sourceRoot":"src/views/components","sourcesContent":["<template slot-scope=\"scope\">\n  <!--  网格试图-->\n  <ul class=\"file-list\" v-loading=\"loading\" element-loading-text=\"加载中……\">\n    <li\n      class=\"file-item\"\n      v-for=\"(item, index) in tableData\"\n      :key=\"index\"\n      @click=\"handleFileNameClick(item)\"\n      :title=\"`${item.file_name}`\"\n    >\n      <img class=\"file-img\" :src=\"setFileImg(item)\" />\n      <div class=\"file-name\">{{ item.file_name }}</div>\n    </li>\n  </ul>\n</template>\n\n<script>\nimport { deleteFile, renameFile } from \"@/request/file\";\n\nexport default {\n  name: \"FileGrid\",\n  props: {\n    // 文件数据\n    tableData: {\n      type: Array,\n      required: true\n    },\n    // 加载状态\n    loading: {\n      type: Boolean,\n      required: true\n    }\n  },\n\n  data() {\n    return {\n      operaColumnIsFold: sessionStorage.getItem(\"operaColumnIsFold\") || false, //  表格操作列-是否收缩\n      //  文件图片Map映射\n      fileImgMap: {\n        csv: require(\"../../assets/images/file/file_csv.png\"),\n        doc: require(\"../../assets/images/file/file_word.svg\"),\n        excel: require(\"../../assets/images/file/file_excel.svg\"),\n        exe: require(\"../../assets/images/file/file_exe.png\"),\n        gif: require(\"../../assets/images/file/file_gif.png\"),\n        html: require(\"../../assets/images/file/file_html.png\"),\n        json: require(\"../../assets/images/file/file_json.png\"),\n        mp3: require(\"../../assets/images/file/file_music.png\"),\n        flac: require(\"../../assets/images/file/file_music.png\"),\n        other: require(\"../../assets/images/file/file_unknown.png\"),\n        pdf: require(\"../../assets/images/file/file_pdf.png\"),\n        ppt: require(\"../../assets/images/file/file_ppt.svg\"),\n        rar: require(\"../../assets/images/file/file_rar.png\"),\n        svg: require(\"../../assets/images/file/file_svg.png\"),\n        fold: require(\"../../assets/images/file/dir.png\"),\n        txt: require(\"../../assets/images/file/file_txt.png\"),\n        zip: require(\"../../assets/images/file/file_zip.png\"),\n        wav: require(\"../../assets/images/file/file_music.png\"),\n        mp4: require(\"../../assets/images/file/file_avi.png\")\n      }\n    };\n  },\n  computed: {\n    // 表格显示列\n    selectedColumnList() {\n      return this.$store.getters.selectedColumnList;\n    }\n  },\n  watch: {\n    // 监听收缩状态变化，存储在sessionStorage中，保证页面刷新时仍然保存设置的状态\n    operaColumnIsFold(newValue) {\n      sessionStorage.setItem(\"operaColumnIsFold\", newValue);\n    }\n  },\n  created() {\n    this.operaColumnIsFold =\n      sessionStorage.getItem(\"operaColumnIsFold\") === \"true\"; //  读取保存的状态\n  },\n  methods: {\n    //  根据文件扩展名设置文件图片\n    setFileImg(row) {\n      if (row._directory) {\n        //  文件夹\n        return this.fileImgMap.fold;\n      } else if ([\"jpg\", \"png\", \"jpeg\", \"gif\"].includes(row.file_type)) {\n        // 图片类型，直接显示缩略图\n        return this.getThumbnailPath(row.id);\n      } else {\n        const fileTypeMap = {\n          pptx: \"ppt\",\n          doc: \"word\",\n          docx: \"doc\",\n          xls: \"excel\",\n          xlsx: \"excel\"\n        };\n        //  可以识别文件类型的文件\n        return (\n          this.fileImgMap[row.file_type] ||\n          this.fileImgMap[fileTypeMap[row.file_type]] ||\n          this.fileImgMap.other\n        );\n      }\n    },\n    // 文件名点击事件\n    handleFileNameClick(row) {\n      //  若是目录则进入目录\n      if (row._directory) {\n        this.$router.push({\n          query: {\n            filePath: `${row.file_url}${row.file_name}/`,\n            fileType: 0\n          }\n        });\n      } else if ([\"jpg\", \"png\", \"jpeg\"].includes(row.file_type)) {\n        // 触发图片在线查看\n        let data = {\n          imgReviewVisible: true,\n          imgReviewList: [\n            {\n              fileUrl: this.getThumbnailPath(row.id),\n              downloadLink: this.getThumbnailPath(row.id),\n              fileName: row.file_name,\n              extendName: row.file_type\n            }\n          ],\n          activeIndex: 0\n        };\n        this.$store.commit(\"setImgReviewData\", data);\n      } else if ([\"mp3\", \"flac\", \"wav\"].includes(row.file_type)) {\n        // 触发音频\n        let data = {\n          audioReviewVisible: true,\n          audioReviewList: [\n            {\n              fileUrl: this.getThumbnailPath(row.id),\n              downloadLink: this.getThumbnailPath(row.id),\n              filename: row.file_name + \".\" + row.file_type\n            }\n          ],\n          activeIndex: 0\n        };\n        this.$store.commit(\"setAudioReviewData\", data);\n      } else if ([\"mp4\", \"wmv\"].includes(row.file_type)) {\n        // 视频\n        let data = {\n          visible: true,\n          url: this.getThumbnailPath(row.id),\n          filename: row.file_name + \".\" + row.file_type\n        };\n        this.$store.commit(\"setVideoReviewData\", data);\n      } else if ([\"txt\", \"js\"].includes(row.file_type)) {\n        // 文本文件\n        let data = {\n          codeReviewVisible: true,\n          fileId: row.id,\n          filename: row.file_name + \".\" + row.file_type\n        };\n        this.$store.commit(\"setCodeReviewData\", data);\n      } else if (\n        [\"ppt\", \"pptx\", \"doc\", \"docx\", \"xls\", \"xlsx\"].includes(row.file_type)\n      ) {\n        //office文件\n        window.open(this.getDownloadFile(row.id), \"_blank\");\n      }\n    },\n    //  计算文件大小\n    calculateFileSize(size) {\n      const B = 1024;\n      const KB = Math.pow(1024, 2);\n      const MB = Math.pow(1024, 3);\n      const GB = Math.pow(1024, 4);\n      if (!size) {\n        return \" \";\n      } else if (size < KB) {\n        return (size / B).toFixed(0) + \"KB\";\n      } else if (size < MB) {\n        return (size / KB).toFixed(1) + \"MB\";\n      } else if (size < GB) {\n        return (size / MB).toFixed(2) + \"GB\";\n      } else {\n        return (size / GB).toFixed(3) + \"TB\";\n      }\n    },\n    // 表格行勾选事件 selection 勾选的表格行数据\n    handleSelectRow(selection) {\n      this.$emit(\"handleSelectFile\", true, selection); // true/false 批量移动/单文件操作；selection 勾选的表格行数据\n    },\n    // 删除按钮 - 点击事件\n    handleClickDelete(row) {\n      // 消息弹框提示用户\n      this.$confirm(\n        \"此操作将删除该文件, 但你依然可以在回收站找到它，是否继续?\",\n        \"提示\",\n        {\n          confirmButtonText: \"确定\",\n          cancelButtonText: \"取消\",\n          type: \"warning\"\n        }\n      )\n        .then(() => {\n          // 确定按钮 点击事件 调用删除文件接口\n          deleteFile(row).then(res => {\n            console.log(res);\n            this.$emit(\"getTableData\"); //  刷新文件列表\n            // this.$message.success(\"删除成功\");\n          });\n        })\n        .catch(() => {\n          //  取消\n          this.$message({\n            type: \"info\",\n            message: \"已取消删除\"\n          });\n        });\n    },\n    // 移动按钮 - 点击事件\n    handleClickMove(row) {\n      this.$emit(\"handleSelectFile\", false, row); // true/false 批量移动/单文件操作；row 当前行文件数据\n      this.$emit(\"handleMoveFile\", true); // true/false 打开/关闭移动文件对话框\n    },\n    // 重命名按钮 - 点击事件\n    handleClickRename(row) {\n      const fileName = row.file_name;\n      this.$prompt(\"请输入文件名\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        inputValue: fileName,\n        inputPattern: /\\S/, //  文件名不能为空\n        inputErrorMessage: \"请输入文件名\",\n        closeOnClickModal: false\n      })\n        .then(({ value }) => {\n          // 确定按钮 调用重命名接口\n          renameFile({\n            ...row,\n            file_name: value\n          }).then(res => {\n            console.log(res);\n            this.$emit(\"getTableData\"); //  刷新文件列表\n            // this.$message.success(\"文件已重命名\");\n          });\n        })\n        .catch(() => {\n          this.$message({\n            type: \"info\",\n            message: \"取消\"\n          });\n        });\n    },\n    // 下载按钮\n    getDownloadPath(row) {\n      return this.getDownloadFile(row.id);\n    }\n  }\n};\n</script>\n\n<style lang=\"stylus\" scoped>\n@import '~@/assets/style/mixins.styl';\n\n.file-list {\n  height: calc(100vh - 237px);\n  display: flex;\n  flex-wrap: wrap;\n  align-items: flex-start;\n  align-content: flex-start;\n  list-style: none;\n  overflow-y: auto;\n  setScrollbar(8px, #EBEEF5, #909399);\n\n  .file-item {\n    margin: 16px 16px 0 0;\n    border-radius: 4px;\n    width: 120px;\n    padding: 8px;\n    cursor: pointer;\n    text-align: center;\n\n    &:hover {\n      background: #F5F7FA;\n    }\n\n    .file-img {\n      width: 100px;\n      height: 100px;\n    }\n\n    .file-name {\n      line-height: 24px;\n      font-size: 12px;\n      word-break: break-all;\n      setEllipsis(2);\n    }\n  }\n}\n</style>\n"]}]}